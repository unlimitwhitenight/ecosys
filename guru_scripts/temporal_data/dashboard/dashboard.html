<html>

<head>
  <title>TigerGraph Time Series Dashboard</title>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.2/css/bootstrap.min.css" integrity="sha384-PsH8R72JQ3SOdhVi3uxftmaW6Vc51MKb0q5P2rRUpPvrszuE4W1povHYgTpBfshb" crossorigin="anonymous">
  <script src="./license.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.7.3/Chart.bundle.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.7.3/Chart.min.js"></script>
  <script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.3/umd/popper.min.js" integrity="sha384-vFJXuSJphROIrBnz7yo7oB41mKfc8JzQZiCq4NCceLEaO4IHwicKwpJf9c9IpFgh" crossorigin="anonymous"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.2/js/bootstrap.min.js" integrity="sha384-alpBpkh1PFOepccYVYDB4do5UnbKysX5WZXm3XxPqe5iKTfUKjNkCk9SaVuEZflJ" crossorigin="anonymous"></script>
  <script src="http://d3js.org/d3.v4.js"></script>
  <script src="https://d3js.org/d3-scale-chromatic.v1.min.js"></script>
  <script src="https://cdn.zoomcharts-cloud.com/1/latest/zoomcharts.js"></script>
</head>

<body style="padding: 0; margin: 0;">
  <div style="height: 100%; background: #dfdfdf;">
    <div style="float: left; height: 100%; width: 38.2%;">
      <div style="height: calc(38.2% - 15px); margin: 10px; background: white; border: 1px solid #ccc; position: relative;">
        <div class="section-title">
          <div style="float:left; width: 200px;">Hot Holiday Destinations</div>
          <select id="homeCountry" style="width: 140px; float: right;" onChange="runHolidayDestinations()">
            <option value="Afghanistan">Afghanistan</option>
            <option value="Algeria">Algeria</option>
            <option value="Angola">Angola</option>
            <option value="Argentina">Argentina</option>
            <option value="Australia">Australia</option>
            <option value="Austria">Austria</option>
            <option value="Azerbaijan">Azerbaijan</option>
            <option value="Belarus">Belarus</option>
            <option value="Belgium">Belgium</option>
            <option value="Bolivia">Bolivia</option>
            <option value="Bosnia_and_Herzegovina">Bosnia_and_Herzegovina</option>
            <option value="Brazil">Brazil</option>
            <option value="Bulgaria">Bulgaria</option>
            <option value="Burma">Burma</option>
            <option value="Cambodia">Cambodia</option>
            <option value="Cameroon">Cameroon</option>
            <option value="Canada">Canada</option>
            <option value="Chad">Chad</option>
            <option value="Chile">Chile</option>
            <option value="China" selected="selected">China</option>
            <option value="Colombia">Colombia</option>
            <option value="Croatia">Croatia</option>
            <option value="Cuba">Cuba</option>
            <option value="Czech_Republic">Czech_Republic</option>
            <option value="Democratic_Republic_of_the_Congo">Democratic_Republic_of_the_Congo</option>
            <option value="Denmark">Denmark</option>
            <option value="Dominican_Republic">Dominican_Republic</option>
            <option value="Egypt">Egypt</option>
            <option value="El_Salvador">El_Salvador</option>
            <option value="England">England</option>
            <option value="Estonia">Estonia</option>
            <option value="Ethiopia">Ethiopia</option>
            <option value="Finland">Finland</option>
            <option value="France">France</option>
            <option value="Germany">Germany</option>
            <option value="Greece">Greece</option>
            <option value="Honduras">Honduras</option>
            <option value="Hong_Kong">Hong_Kong</option>
            <option value="Hungary">Hungary</option>
            <option value="India">India</option>
            <option value="Indonesia">Indonesia</option>
            <option value="Iran">Iran</option>
            <option value="Israel">Israel</option>
            <option value="Italy">Italy</option>
            <option value="Japan">Japan</option>
            <option value="Jordan">Jordan</option>
            <option value="Kazakhstan">Kazakhstan</option>
            <option value="Kenya">Kenya</option>
            <option value="Laos">Laos</option>
            <option value="Latvia">Latvia</option>
            <option value="Liberia">Liberia</option>
            <option value="Libya">Libya</option>
            <option value="Lithuania">Lithuania</option>
            <option value="Madagascar">Madagascar</option>
            <option value="Malaysia">Malaysia</option>
            <option value="Malta">Malta</option>
            <option value="Mauritania">Mauritania</option>
            <option value="Mauritius">Mauritius</option>
            <option value="Mexico">Mexico</option>
            <option value="Moldova">Moldova</option>
            <option value="Mongolia">Mongolia</option>
            <option value="Morocco">Morocco</option>
            <option value="Namibia">Namibia</option>
            <option value="Nepal">Nepal</option>
            <option value="Netherlands">Netherlands</option>
            <option value="New_Zealand">New_Zealand</option>
            <option value="Nicaragua">Nicaragua</option>
            <option value="Niger">Niger</option>
            <option value="Northern_Ireland">Northern_Ireland</option>
            <option value="Norway">Norway</option>
            <option value="Oman">Oman</option>
            <option value="Pakistan">Pakistan</option>
            <option value="Panama">Panama</option>
            <option value="Papua_New_Guinea">Papua_New_Guinea</option>
            <option value="Peru">Peru</option>
            <option value="Philippines">Philippines</option>
            <option value="Poland">Poland</option>
            <option value="Portugal">Portugal</option>
            <option value="Puerto_Rico">Puerto_Rico</option>
            <option value="Republic_of_Ireland">Republic_of_Ireland</option>
            <option value="Republic_of_Macedonia">Republic_of_Macedonia</option>
            <option value="Romania">Romania</option>
            <option value="Russia">Russia</option>
            <option value="Rwanda">Rwanda</option>
            <option value="Scotland">Scotland</option>
            <option value="Senegal">Senegal</option>
            <option value="Singapore">Singapore</option>
            <option value="Slovakia">Slovakia</option>
            <option value="Slovenia">Slovenia</option>
            <option value="South_Africa">South_Africa</option>
            <option value="South_Korea">South_Korea</option>
            <option value="Spain">Spain</option>
            <option value="Sri_Lanka">Sri_Lanka</option>
            <option value="Swaziland">Swaziland</option>
            <option value="Sweden">Sweden</option>
            <option value="Switzerland">Switzerland</option>
            <option value="Taiwan">Taiwan</option>
            <option value="Tajikistan">Tajikistan</option>
            <option value="Tanzania">Tanzania</option>
            <option value="Thailand">Thailand</option>
            <option value="Tunisia">Tunisia</option>
            <option value="Turkey">Turkey</option>
            <option value="Ukraine">Ukraine</option>
            <option value="United_Kingdom">United_Kingdom</option>
            <option value="United_States">United_States</option>
            <option value="Uruguay">Uruguay</option>
            <option value="Venezuela">Venezuela</option>
            <option value="Vietnam">Vietnam</option>
            <option value="Wales">Wales</option>
            <option value="Yemen">Yemen</option>
            <option value="Zambia">Zambia</option>
          </select>
          <label style="float:right;">from&nbsp;&nbsp;</label>
        </div>
        <div class="section-content">
          <div id="holidayDestinationsChart" style="width: 100%; height: 100%;"></div>
        </div>
        <div class="loading-indicator" id="holidayDestinationsLoading">
          <div class="loader"></div>
        </div>
      </div>
      <div style="height: calc(61.8% - 15px); margin: 10px; background: white; border: 1px solid #ccc; position: relative;">
        <div class="section-title">
          <div style="float:left; width: 150px;">Number of Posts</div>
          <select id="postSummaryEndDate" style="width: 90px; float: right;" onChange="runPostSummary()">
            <option value="2010-01-31">2010.1</option>
            <option value="2010-02-28">2010.2</option>
            <option value="2010-03-31">2010.3</option>
            <option value="2010-04-30">2010.4</option>
            <option value="2010-05-31">2010.5</option>
            <option value="2010-06-30">2010.6</option>
            <option value="2010-07-31">2010.7</option>
            <option value="2010-08-31">2010.8</option>
            <option value="2010-09-30">2010.9</option>
            <option value="2010-10-31">2010.10</option>
            <option value="2010-11-30">2010.11</option>
            <option value="2010-12-31">2010.12</option>
            <option value="2011-01-31">2011.1</option>
            <option value="2011-02-28">2011.2</option>
            <option value="2011-03-31">2011.3</option>
            <option value="2011-04-30">2011.4</option>
            <option value="2011-05-31">2011.5</option>
            <option value="2011-06-30">2011.6</option>
            <option value="2011-07-31">2011.7</option>
            <option value="2011-08-31">2011.8</option>
            <option value="2011-09-30">2011.9</option>
            <option value="2011-10-31">2011.10</option>
            <option value="2011-11-30">2011.11</option>
            <option value="2011-12-31">2011.12</option>
            <option value="2012-01-31">2012.1</option>
            <option value="2012-02-29">2012.2</option>
            <option value="2012-03-31">2012.3</option>
            <option value="2012-04-30">2012.4</option>
            <option value="2012-05-31">2012.5</option>
            <option value="2012-06-30" selected="selected">2012.6</option>
            <option value="2012-07-31">2012.7</option>
            <option value="2012-08-31">2012.8</option>
            <option value="2012-09-30">2012.9</option>
          </select>
          <label style="float:right;">&nbsp;&nbsp;to&nbsp;&nbsp;</label>
          <select id="postSummaryStartDate" style="width: 90px; float: right;" onChange="runPostSummary()">
            <option value="2010-01-01">2010.1</option>
            <option value="2010-02-01">2010.2</option>
            <option value="2010-03-01">2010.3</option>
            <option value="2010-04-01">2010.4</option>
            <option value="2010-05-01">2010.5</option>
            <option value="2010-06-01">2010.6</option>
            <option value="2010-07-01">2010.7</option>
            <option value="2010-08-01">2010.8</option>
            <option value="2010-09-01">2010.9</option>
            <option value="2010-10-01">2010.10</option>
            <option value="2010-11-01">2010.11</option>
            <option value="2010-12-01">2010.12</option>
            <option value="2011-01-01">2011.1</option>
            <option value="2011-02-01">2011.2</option>
            <option value="2011-03-01">2011.3</option>
            <option value="2011-04-01">2011.4</option>
            <option value="2011-05-01">2011.5</option>
            <option value="2011-06-01">2011.6</option>
            <option value="2011-07-01">2011.7</option>
            <option value="2011-08-01">2011.8</option>
            <option value="2011-09-01">2011.9</option>
            <option value="2011-10-01">2011.10</option>
            <option value="2011-11-01">2011.11</option>
            <option value="2011-12-01">2011.12</option>
            <option value="2012-01-01" selected="selected">2012.1</option>
            <option value="2012-02-01">2012.2</option>
            <option value="2012-03-01">2012.3</option>
            <option value="2012-04-01">2012.4</option>
            <option value="2012-05-01">2012.5</option>
            <option value="2012-06-01">2012.6</option>
            <option value="2012-07-01">2012.7</option>
            <option value="2012-08-01">2012.8</option>
            <option value="2012-09-01">2012.9</option>
          </select>
          <label style="float:right;">from&nbsp;&nbsp;</label>
        </div>
        <div class="section-content">
          <canvas id="postSummaryChart" style="width: 100%; height: 100%;"></canvas>
        </div>
        <div class="loading-indicator" id="postSummaryLoading">
          <div class="loader"></div>
        </div>
      </div>
    </div>
    <div style="float: left; height: 100%; width: 61.8%;">
      <div style="height: calc(61.8% - 15px); margin: 10px 10px 10px 0; background: white; border: 1px solid #ccc; position: relative;">
        <div class="section-title">
          <div style="float:left; width: 200px;">Topics Around The World</div>
          <select id="topicContinentTagClass" style="width: 200px; float: right;" onChange="runTopicContinent()">
            <option value='FormulaOneRacer'>FormulaOneRacer</option>
            <option value='GolfPlayer'>GolfPlayer</option>
            <option value='Governor'>Governor</option>
            <option value='GridironFootballPlayer'>GridironFootballPlayer</option>
            <option value='IceHockeyPlayer'>IceHockeyPlayer</option>
            <option value='Judge'>Judge</option>
            <option value='MartialArtist'>MartialArtist</option>
            <option value='MemberOfParliament'>MemberOfParliament</option>
            <option value='MilitaryPerson'>MilitaryPerson</option>
            <option value='MilitaryUnit'>MilitaryUnit</option>
            <option value='Model'>Model</option>
            <option value='Monarch'>Monarch</option>
            <option value='MusicalArtist' selected="selected">MusicalArtist</option>
            <option value='MusicalWork'>MusicalWork</option>
            <option value='NascarDriver'>NascarDriver</option>
            <option value='OfficeHolder'>OfficeHolder</option>
            <option value='Organisation'>Organisation</option>
            <option value='OrganisationMember'>OrganisationMember</option>
            <option value='Person'>Person</option>
            <option value='Philosopher'>Philosopher</option>
            <option value='Place'>Place</option>
            <option value='Politician'>Politician</option>
            <option value='PopulatedPlace'>PopulatedPlace</option>
            <option value='President'>President</option>
            <option value='PrimeMinister'>PrimeMinister</option>
            <option value='Royalty'>Royalty</option>
            <option value='Saint'>Saint</option>
            <option value='Scientist'>Scientist</option>
            <option value='Senator'>Senator</option>
            <option value='Single'>Single</option>
            <option value='SnookerChamp'>SnookerChamp</option>
            <option value='SnookerPlayer'>SnookerPlayer</option>
            <option value='SoccerManager'>SoccerManager</option>
            <option value='SoccerPlayer'>SoccerPlayer</option>
            <option value='Song'>Song</option>
            <option value='SportsTeamMember'>SportsTeamMember</option>
            <option value='TennisPlayer'>TennisPlayer</option>
            <option value='Thing'>Thing</option>
            <option value='Work'>Work</option>
            <option value='Wrestler'>Wrestler</option>
            <option value='Writer'>Writer</option>
          </select>
          <label style="float:right;">&nbsp;&nbsp;tag class&nbsp;&nbsp;</label>
        </div>
        <div class="section-content">
          <div id="messageTopicContinentChart" style="width: 100%; height: 100%;"></div>
        </div>
        <div style="position: absolute; right: 20; top: 60; width: 120px;">
          <span style="background: #1f77b4">&nbsp;&nbsp;&nbsp;&nbsp;</span>&nbsp;&nbsp;messages
        </div>
        <div style="position: absolute; right: 20; top: 100; width: 120px;">
          <span style="background: #ff7f0e">&nbsp;&nbsp;&nbsp;&nbsp;</span>&nbsp;&nbsp;likes
        </div>
        <div class="loading-indicator" id="topicContinentLoading">
          <div class="loader"></div>
        </div>
      </div>
      <div style="height: calc(38.2% - 15px); margin: 10px 10px 10px 0; background: white; border: 1px solid #ccc; position: relative;">
        <div class="section-title">
          <div style="float:left; width: 150px;">Most Fluctuant Tags</div>
          <select id="tagEvolutionMonth" style="width: 90px; float: right;" onChange="runTagEvolution()">
            <option value="2010-01-31">2010.1</option>
            <option value="2010-02-28">2010.2</option>
            <option value="2010-03-31">2010.3</option>
            <option value="2010-04-30">2010.4</option>
            <option value="2010-05-31">2010.5</option>
            <option value="2010-06-30">2010.6</option>
            <option value="2010-07-31">2010.7</option>
            <option value="2010-08-31">2010.8</option>
            <option value="2010-09-30">2010.9</option>
            <option value="2010-10-31">2010.10</option>
            <option value="2010-11-30">2010.11</option>
            <option value="2010-12-31">2010.12</option>
            <option value="2011-01-31">2011.1</option>
            <option value="2011-02-28">2011.2</option>
            <option value="2011-03-31">2011.3</option>
            <option value="2011-04-30">2011.4</option>
            <option value="2011-05-31">2011.5</option>
            <option value="2011-06-30">2011.6</option>
            <option value="2011-07-31">2011.7</option>
            <option value="2011-08-31">2011.8</option>
            <option value="2011-09-30">2011.9</option>
            <option value="2011-10-31">2011.10</option>
            <option value="2011-11-30">2011.11</option>
            <option value="2011-12-31">2011.12</option>
            <option value="2012-01-31">2012.1</option>
            <option value="2012-02-29">2012.2</option>
            <option value="2012-03-31">2012.3</option>
            <option value="2012-04-30">2012.4</option>
            <option value="2012-05-31">2012.5</option>
            <option value="2012-06-30" selected="selected">2012.6</option>
            <option value="2012-07-31">2012.7</option>
            <option value="2012-08-31">2012.8</option>
          </select>
          <label style="float:right;">&nbsp;&nbsp;month&nbsp;&nbsp;</label>
        </div>
        <div class="section-content">
          <canvas id="tagEvolutionChart" style="width: 100%; height: 100%;"></canvas>
        </div>
        <div class="loading-indicator" id="tagEvolutionLoading">
          <div class="loader"></div>
        </div>
      </div>
    </div>
  </div>
</body>

<style>
  .hidden {
    display: none;
  }

  .section-title {
    height: 40px;
    border-bottom: 1px solid #ccc;
    padding: 8px 10px 12px 10px;
    background: #f6f6f6;
    color: #666;
  }

  .section-content {
    height: calc(100% - 40px);
    padding: 10px;
  }

  .loading-indicator {
    height: 100%;
    width: 100%;
    top: 0;
    left: 0;
    position: absolute;
    padding: 0;
    background-color: rgba(255, 255, 255, 0.5);
  }

  .loader {
    position:absolute;
    top: calc(50% - 60px);
    left: calc(50% - 60px);
    border: 16px solid rgba(255, 255, 255, 0.5); /* Light grey */
    border-top: 16px solid #009688; /* Blue */
    border-radius: 50%;
    width: 120px;
    height: 120px;
    animation: spin 2s linear infinite;
  }

  @keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
  }
</style>
<script type="text/javascript">

  // Customizable params.
  var messageThreshold = 0;

  // Colors
  var colors = ['#1f77b4', '#ff7f0e', '#2ca02c', '#d62728', '#9467bd', '#8c564b', '#e377c2', '#7f7f7f', '#bcbd22', '#17becf', '#aec7e8', '#ffbb78', '#98df8a', '#ff9896', '#c5b0d5', '#c49c94', '#f7b6d2', '#c7c7c7', '#dbdb8d', '#9edae5', '#393b79', '#5254a3', '#6b6ecf', '#9c9ede', '#637939', '#8ca252', '#b5cf6b', '#cedb9c', '#8c6d31', '#bd9e39', '#e7ba52', '#e7cb94', '#843c39', '#ad494a', '#d6616b', '#e7969c', '#7b4173', '#a55194', '#ce6dbd', '#de9ed6', '#3182bd', '#6baed6', '#9ecae1', '#c6dbef', '#e6550d', '#fd8d3c', '#fdae6b', '#fdd0a2', '#31a354', '#74c476', '#a1d99b', '#c7e9c0', '#756bb1', '#9e9ac8', '#bcbddc', '#dadaeb', '#636363', '#969696', '#bdbdbd', '#d9d9d9'];
  var streamColor = [1, 11, 3, 0, 9, 2];

  function hexToRgbA(hex, alpha){
    var c;
    if(/^#([A-Fa-f0-9]{3}){1,2}$/.test(hex)){
        c= hex.substring(1).split('');
        if(c.length== 3){
            c= [c[0], c[0], c[1], c[1], c[2], c[2]];
        }
        c= '0x'+c.join('');
        return 'rgba('+[(c>>16)&255, (c>>8)&255, c&255].join(',')+ `, ${alpha ? alpha : 0.8})`;
    }
    return `rgba(0, 0, 0, ${alpha ? alpha : 0.4})`;
  }

  // Num to Month
  var monthMap = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];

  // Post Summary
  var postSummaryCtx = document.getElementById("postSummaryChart").getContext('2d');
  var postSummaryChart = new Chart(postSummaryCtx, {
      type: 'bar',
      data: {
        labels: [],
        datasets: []
      },
      options: {
          maintainAspectRatio: false,
          scales: {
              xAxes: [{ stacked: true }],
              yAxes: [{
                  ticks: {
                      beginAtZero:true
                  },
                  stacked: true
              }]
          }
      }
  });

  function renderPostSummaryChart(gsqlResponse) {
    var gsqlJson = gsqlResponse;
    // Post summary chart
    var postData = gsqlJson.results[0]['@@result'];

    var months = new Set();
    postData.forEach(element => months.add(element['Mon']));
    var monthsArray = Array.from(months).sort((a, b) => a - b);

    postSummaryChart.data.labels = monthsArray.map(mon => monthMap[mon - 1]);

    var posts =[
      {
        label: "short post",
        backgroundColor: hexToRgbA(colors[1]),
        borderColor: colors[1],
        borderWidth: 1,
        data: postSummaryChart.data.labels.map(() => 0),
        stack: 1
      },
      {
        label: "one liner post",
        backgroundColor: hexToRgbA(colors[6]),
        borderColor: colors[6],
        borderWidth: 1,
        data: postSummaryChart.data.labels.map(() => 0),
        stack: 1
      },
      {
        label: "tweet post",
        backgroundColor: hexToRgbA(colors[11]),
        borderColor: colors[11],
        borderWidth: 1,
        data: postSummaryChart.data.labels.map(() => 0),
        stack: 1
      },
      {
        label: "long post",
        backgroundColor: hexToRgbA(colors[3]),
        borderColor: colors[3],
        borderWidth: 1,
        data: postSummaryChart.data.labels.map(() => 0),
        stack: 1
      },
      {
        label: "short comment",
        backgroundColor: hexToRgbA(colors[0]),
        borderColor: colors[0],
        borderWidth: 1,
        data: postSummaryChart.data.labels.map(() => 0),
        stack: 2
      },
      {
        label: "one liner comment",
        backgroundColor: hexToRgbA(colors[9]),
        borderColor: colors[9],
        borderWidth: 1,
        data: postSummaryChart.data.labels.map(() => 0),
        stack: 2
      },
      {
        label: "tweet comment",
        backgroundColor: hexToRgbA(colors[2]),
        borderColor: colors[2],
        borderWidth: 1,
        data: postSummaryChart.data.labels.map(() => 0),
        stack: 2
      },
      {
        label: "long comment",
        backgroundColor: hexToRgbA(colors[7]),
        borderColor: colors[7],
        borderWidth: 1,
        data: postSummaryChart.data.labels.map(() => 0),
        stack: 2
      }
    ];

    postData.forEach(dp => {
      var offset1 = (+dp['lengthCategory']) + (dp['isComment'] ? 4 : 0);
      var offset2 = monthsArray.indexOf(dp['Mon']);
      posts[offset1]['data'][offset2] = dp['messageCount'];
    });

    postSummaryChart.data.datasets = posts;
    postSummaryChart.update();
  }

  function runPostSummary() {
    $("#postSummaryLoading").removeClass("hidden");
    var startDate = $('#postSummaryStartDate').val();
    var endDate = $('#postSummaryEndDate').val();
    $.get(`query/ldbc_snb/postSummary?startDate=${startDate}&endDate=${endDate}`, function( data ) {
      $("#postSummaryLoading").addClass("hidden");
      renderPostSummaryChart(data);
    });
  }
  runPostSummary();

  // Holiday Destinations
  var holidayDestinationData = null;

  $(window).resize(function() {
    renderChart('#holidayDestinationsChart');
  });

  function renderChart(container) {
    if (holidayDestinationData === null) {
      return;
    }

    // set the dimensions and margins of the graph
    var margin = {top: 5, right: 10, bottom: 15, left: 10},
        width = $(container).width() - margin.left - margin.right,
        height = $(container).height() - margin.top - margin.bottom;

    $(container).html('');
    // append the svg object to the body of the page
    var svg = d3.select(container)
      .append("svg")
        .attr("width", width + margin.left + margin.right)
        .attr("height", height + margin.top + margin.bottom)
      .append("g")
        .attr("transform",
              "translate(" + margin.left + "," + margin.top + ")");

    svg.attr("width", width + margin.left + margin.right)
      .attr("height", height + margin.top + margin.bottom);

    // List of groups = header of the csv files
    var keys = holidayDestinationData.columns.slice(1);

    // Add X axis
    var x = d3.scaleLinear()
      .domain(d3.extent(holidayDestinationData.data, function(d) { return d.month; }))
      .range([ 0, width ]);
    svg.append("g")
      .attr("transform", "translate(0," + height + ")")
      .call(d3.axisBottom(x).tickSize(-height).tickValues([1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12]).tickFormat(function(d,i){ return monthMap[i] }))
      .select(".domain").remove()
    // Customization
    svg.selectAll(".tick line").attr("stroke", "#ddd")

    // Get max sum.
    var maxSum = 0;
    holidayDestinationData.data.forEach(monthData => {
      maxSum = Math.max(maxSum, holidayDestinationData.columns.filter(col => col !== 'month').map(col => monthData[col]).reduce((a, b) => a + b));
    });

    // Add Y axis
    var y = d3.scaleLinear()
      .domain([-maxSum / 2, maxSum / 2])
      .range([ height, 0 ]);

    // color palette
    var color = d3.scaleOrdinal()
      .domain(keys)
      .range(d3.schemeDark2);

    //stack the data?
    var stackedData = d3.stack()
      .offset(d3.stackOffsetSilhouette)
      .keys(keys)
      (holidayDestinationData.data)

    // create a tooltip
    var Tooltip = svg
      .append("text")
      .attr("x", 0)
      .attr("y", 0)
      .style("opacity", 0)
      .style("font-size", 17)

    // Three function that change the tooltip when user hover / move / leave a cell
    var mouseover = function(d) {
      Tooltip.style("opacity", 1)
      d3.selectAll(".myArea").style("opacity", .2)
      d3.select(this)
        .style("stroke", "black")
        .style("opacity", 1)
    }
    var tooltip = d3.select("body")
      .append("div")
      .attr("class", "tip")
      .style("position", "absolute")
      .style("z-index", "20")
      .style("visibility", "hidden")
      .style("top", 40+"px");

    var mousemove = function(d,i) {
      grp = keys[i]
      mouse = d3.mouse(this);
      mousex = mouse[0], mousey = mouse[1];

      Array.from(d.values()).forEach(function(f) {
        var month = f.data.month;
        if (Math.round(x.invert(mousex)) == month){
          tooltip
            .style("left", (mousex + 40) +"px")
            .style("top", (mousey + 25) +"px")
            .style("background", "white")
            .style("padding", "10px")
            .style("border", "1px solid #999")
            .html('<div><div style="font-size: 18px;"><b>' + monthMap[month - 1] + "</b></div>" + 
              "<div><span style='background:" + hexToRgbA(colors[streamColor[holidayDestinationData.columns.indexOf(d.key) - 1]], 0.8) +
              ";'>&nbsp;&nbsp;&nbsp;&nbsp;</span>&nbsp;&nbsp;" + 
              d.key + "</div><div>" + f.data[d.key] + " posts</div></div>")
            .style("visibility", "visible");
        }
      });
    }
    var mouseleave = function(d) {
      Tooltip.style("opacity", 0)
      d3.selectAll(".myArea").style("opacity", 1).style("stroke", "none");
      tooltip.style("visibility", "hidden");
    }

    // Area generator
    var area = d3.area()
      .x(function(d) { return x(d.data.month); })
      .y0(function(d) { return y(d[0]); })
      .y1(function(d) { return y(d[1]); })

    // Show the areas
    svg
      .selectAll("mylayers")
      .data(stackedData)
      .enter()
      .append("path")
        .attr("class", "myArea")
        .style("fill", function(d, i) { return hexToRgbA(colors[streamColor[i]], 0.8); })
        .attr("d", area)
        .on("mouseover", mouseover)
        .on("mousemove", mousemove)
        .on("mouseleave", mouseleave)
  }


  function runHolidayDestinations() {
    $("#holidayDestinationsLoading").removeClass("hidden");
    var homeCountry = $('#homeCountry').val();
    $.get(`query/ldbc_snb/holidayDestinations?homeCountry=${homeCountry}&messageThreshold=${messageThreshold}`, function( data ) {
      $("#holidayDestinationsLoading").addClass("hidden");
      
      // Parse the Data
      var result = data['results'][0]['@@result'];

      holidayDestinationData = {
        'columns': [
          'month',
          'Africa',
          'Asia',
          'Australia',
          'Europe',
          'North_America',
          'South_America'
        ],
        'data': []
      };
      for (var i = 1; i <= 12; i++) {
        holidayDestinationData.data.push({
            'month': i,
            'Africa': 0,
            'Asia': 0,
            'Australia': 0,
            'Europe': 0,
            'North_America': 0,
            'South_America': 0
        });
      };

      result.forEach(element => holidayDestinationData.data[element['mon'] - 1][element['destinationName']] = element['messageCount']);
      renderChart('#holidayDestinationsChart');
    });
  }
  runHolidayDestinations();

  // Most Flunctuate Tags
  var tagEvolutionCtx = document.getElementById("tagEvolutionChart").getContext('2d');
  var tagEvolutionChart = new Chart(tagEvolutionCtx, {
      type: 'bar',
      data: {
        labels: [],
        datasets: []
      },
      options: {
          maintainAspectRatio: false,
          legend: {
            display: false
          },
          scales: {
              yAxes: [{
                  ticks: {
                      beginAtZero: true
                  },
              }],
              xAxes: [{
                  ticks: {
                      display: false
                  },
              }]
          }
      }
  });

  function renderTagEvolutionChart(gsqlResponse) {
    var gsqlJson = gsqlResponse;
    // Post summary chart
    var postData = gsqlJson.results[0]['@@result'];
    var incListTitle = [], decListTitle = [], incNum = [], decNum = [];
    postData.forEach(data => {
      if (data['diff'] > 0) {
        incListTitle.push(data['tagName']);
        incNum.push(data['diff']);
      } else {
        decListTitle.push(data['tagName']);
        decNum.push(data['diff']);
      }
    });

    var titles = incListTitle.concat(decListTitle.reverse());
    var datas = incNum.concat(decNum.reverse());
    

    tagEvolutionChart.data.labels = titles;

    var tagEvolution =[
      {
        label: "tag fluctuation",
        backgroundColor: incNum.map(() => hexToRgbA(colors[0])).concat(decNum.map(() => hexToRgbA(colors[1]))),
        borderColor: incNum.map(() => colors[0]).concat(decNum.map(() => colors[1])),
        borderWidth: 1,
        data: datas,
      }
    ];

    tagEvolutionChart.data.datasets = tagEvolution;
    tagEvolutionChart.update();
  }

  function runTagEvolution() {
    $("#tagEvolutionLoading").removeClass("hidden");
    var date = $('#tagEvolutionMonth').val().split('-');
    var year = date[0], month = date[1];
    $.get(`query/ldbc_snb/tagEvolution?givenYear=${year}&givenMonth=${month}&K=15`, function( data ) {
      $("#tagEvolutionLoading").addClass("hidden");
      renderTagEvolutionChart(data);
    });
  }
  runTagEvolution();


  function renderTopicContinentChart(data) {
    var result = data['results'][0]['@@result'];

    var processData = {
      "Africa": [],
      "Asia": [],
      "Australia": [],
      "Europe": [],
      "North_America": [],
      "South_America": [],
    };
    result.forEach(element => processData[element['continentName']].push([
      new Date(element['Y'] + '.' + element['M']).getTime() / 1000, element['messageCount'], element['likeCount']
    ]));

    // Topics Around The World
    var options = {
        container: "messageTopicContinentChart",
        data:[
            // continents
            {
                id: "shapes",
                preloaded:     {
                    nodes: [
                        { id: "Africa", coordinates: [22.709510, 3.774191] },
                        { id: "Asia", coordinates: [104.536798, 48.062542] },
                        { id: "Australia", coordinates: [133.497043, -17.376845] },
                        { id: "Europe", coordinates: [16.2396344, 62.2208282] },
                        { id: "North_America", coordinates: [-103.012858, 50.431205] },
                        { id: "South_America", coordinates: [-58.592995, -14.637311] },
                    ]
                }
            }
        ],
        layers:[
            {
                id: "shapes",
                type: "items",
                data: {
                    id: "shapes"
                },
                style:{
                    nodeStyleFunction: function(node){
                      node.radius = 100;
                      node.fillColor = "rgba(0, 0, 0, 0)";
                      node.lineColor = "rgba(0, 0, 0, 0";
                      node.labelStyle = {
                          backgroundStyle: {
                              fillColor:"rgba(0, 0, 0, 0)",
                              lineColor:"rgba(0, 0, 0, 0)",
                              lineWidth: 3
                          },
                          textStyle: {
                              fillColor: "black"
                          }
                      }
                    }
                }
            },
            {
                id: "line",
                type: "charts",
                shapesLayer: "shapes",
                chartType: "timechart",
                settingsFunction: function (node, data) {
                    return {
                        valueAxisDefault: {
                          logScale: true,
                          hgrid: true
                        },
                        toolbar: {
                            items: [
                            ],
                            extraItems: [
                            ]
                        },
                        area: {
                          width: 160,
                          height: 120,
                        },
                        legend:{
                            enabled: true
                        },
                        series:[
                            {
                                name:"messages",
                                id: "messages",
                                type: "columns",
                                data:{
                                    index:1,
                                },
                                style:{
                                    lineColor: colors[0],
                                    lineWidth: 3,
                                    fillColor: colors[0],
                                }
                            },
                            {
                                name: "likes",
                                id: "likes",
                                type: "line",
                                data:{
                                    index:2,
                                },
                                style:{
                                    smoothing: false,
                                    lineColor: colors[1],
                                    lineWidth: 3
                                }
                            }
                        ],
                        data: {
                            units: ["M"],
                            timestampInSeconds: true,
                            preloaded: {
                                dataLimitFrom: 1262304000,
                                dataLimitTo: 1348963200,
                                unit: "M",
                                values: processData[node['id']]
                            }
                        }
                    };
                }
            }
        ],
        navigation: {
            initialLat: 20,
            initialLng: 10,
            initialZoom: 2,
            minZoom: 2,
            maxZoom: 5,
        }
    };

    chart = new GeoChart(options);
  }

  function runTopicContinent() {
    $("#topicContinentLoading").removeClass("hidden");
    var tagClass = $('#topicContinentTagClass').val();
    $.get(`query/ldbc_snb/messageTopicContinent?tagClass=${tagClass}&K=1024`, function( data ) {
      $("#topicContinentLoading").addClass("hidden");
      renderTopicContinentChart(data);
    });
  }
  runTopicContinent();
</script>
</html>
